<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head th:replace="fragments/layout :: head">
    <title th:text="${user.id != null ? 'S·ª≠a ng∆∞·ªùi d√πng' : 'Th√™m ng∆∞·ªùi d√πng'} + ' - Video Management System'"></title>
</head>
<body>
    <nav th:replace="fragments/layout :: navbar"></nav>
    <div th:replace="fragments/layout :: alerts"></div>
    
    <div class="container mt-4">
        <!-- Breadcrumb -->
        <nav aria-label="breadcrumb">
            <ol class="breadcrumb">
                <li class="breadcrumb-item"><a href="/home" class="text-decoration-none">Trang ch·ªß</a></li>
                <li class="breadcrumb-item"><a href="/users" class="text-decoration-none">Qu·∫£n l√Ω ng∆∞·ªùi d√πng</a></li>
                <li class="breadcrumb-item active" th:text="${user.id != null ? 'S·ª≠a ng∆∞·ªùi d√πng' : 'Th√™m ng∆∞·ªùi d√πng'}"></li>
            </ol>
        </nav>
        
        <div class="row justify-content-center">
            <div class="col-lg-10 col-xl-8">
                <div class="card border-0 shadow-sm">
                    <div class="card-header bg-info text-white">
                        <h4 class="mb-0">
                            <i class="fas fa-user me-2"></i>
                            <span th:text="${user.id != null ? 'S·ª≠a th√¥ng tin ng∆∞·ªùi d√πng' : 'Th√™m ng∆∞·ªùi d√πng m·ªõi'}"></span>
                        </h4>
                    </div>
                    
                    <div class="card-body p-4">
                        <form method="post" 
                              th:action="${user.id != null ? '/users/edit/' + user.id : '/users/add'}"
                              th:object="${user}" 
                              enctype="multipart/form-data">
                            
                            <div class="row">
                                <!-- Left Column -->
                                <div class="col-lg-6">
                                    <!-- User ID (Read-only for edit) -->
                                    <div class="mb-4" th:if="${user.id != null}">
                                        <label for="userId" class="form-label fw-semibold">
                                            <i class="fas fa-hashtag text-info me-1"></i>
                                            ID Ng∆∞·ªùi d√πng
                                        </label>
                                        <input type="text" class="form-control-plaintext form-control-lg bg-light" 
                                               id="userId" th:value="${user.id}" readonly>
                                        <div class="form-text">ID ng∆∞·ªùi d√πng kh√¥ng th·ªÉ thay ƒë·ªïi</div>
                                    </div>

                                    <!-- Username -->
                                    <div class="mb-4">
                                        <label for="username" class="form-label fw-semibold">
                                            <i class="fas fa-user text-info me-1"></i>
                                            T√™n ƒëƒÉng nh·∫≠p <span class="text-danger">*</span>
                                        </label>
                                        <input type="text" class="form-control form-control-lg" id="username" th:field="*{username}" 
                                               placeholder="Nh·∫≠p t√™n ƒëƒÉng nh·∫≠p..."
                                               th:class="${#fields.hasErrors('username')} ? 'form-control form-control-lg is-invalid' : 'form-control form-control-lg'">
                                        <div class="form-text">T·ª´ 3-50 k√Ω t·ª±, kh√¥ng c√≥ d·∫•u c√°ch v√† k√Ω t·ª± ƒë·∫∑c bi·ªát</div>
                                        <div class="invalid-feedback" th:if="${#fields.hasErrors('username')}" th:errors="*{username}"></div>
                                    </div>

                                    <!-- Email -->
                                    <div class="mb-4">
                                        <label for="email" class="form-label fw-semibold">
                                            <i class="fas fa-envelope text-info me-1"></i>
                                            Email <span class="text-danger">*</span>
                                        </label>
                                        <input type="email" class="form-control form-control-lg" id="email" th:field="*{email}"
                                               placeholder="example@email.com"
                                               th:class="${#fields.hasErrors('email')} ? 'form-control form-control-lg is-invalid' : 'form-control form-control-lg'">
                                        <div class="form-text">Email d√πng ƒë·ªÉ ƒëƒÉng nh·∫≠p v√† nh·∫≠n th√¥ng b√°o</div>
                                        <div class="invalid-feedback" th:if="${#fields.hasErrors('email')}" th:errors="*{email}"></div>
                                    </div>

                                    <!-- Full Name -->
                                    <div class="mb-4">
                                        <label for="fullname" class="form-label fw-semibold">
                                            <i class="fas fa-id-card text-info me-1"></i>
                                            H·ªç v√† t√™n <span class="text-danger">*</span>
                                        </label>
                                        <input type="text" class="form-control form-control-lg" id="fullname" th:field="*{fullname}"
                                               placeholder="Nh·∫≠p h·ªç t√™n ƒë·∫ßy ƒë·ªß..."
                                               th:class="${#fields.hasErrors('fullname')} ? 'form-control form-control-lg is-invalid' : 'form-control form-control-lg'">
                                        <div class="invalid-feedback" th:if="${#fields.hasErrors('fullname')}" th:errors="*{fullname}"></div>
                                    </div>

                                    <!-- Password (only for new user) -->
                                    <div class="mb-4" th:if="${user.id == null}">
                                        <label for="password" class="form-label fw-semibold">
                                            <i class="fas fa-lock text-info me-1"></i>
                                            M·∫≠t kh·∫©u <span class="text-danger">*</span>
                                        </label>
                                        <input type="password" class="form-control form-control-lg" id="password" th:field="*{password}"
                                               placeholder="Nh·∫≠p m·∫≠t kh·∫©u..."
                                               th:class="${#fields.hasErrors('password')} ? 'form-control form-control-lg is-invalid' : 'form-control form-control-lg'">
                                        <div class="form-text">√çt nh·∫•t 6 k√Ω t·ª±, n√™n c√≥ ch·ªØ hoa, ch·ªØ th∆∞·ªùng v√† s·ªë</div>
                                        <div class="invalid-feedback" th:if="${#fields.hasErrors('password')}" th:errors="*{password}"></div>
                                    </div>

                                    <!-- Password note for edit -->
                                    <div class="mb-4" th:if="${user.id != null}">
                                        <div class="alert alert-info">
                                            <i class="fas fa-info-circle me-2"></i>
                                            <strong>L∆∞u √Ω:</strong> M·∫≠t kh·∫©u s·∫Ω gi·ªØ nguy√™n khi c·∫≠p nh·∫≠t th√¥ng tin.
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- Right Column -->
                                <div class="col-lg-6">
                                    <!-- Phone Number -->
                                    <div class="mb-4">
                                        <label for="phone" class="form-label fw-semibold">
                                            <i class="fas fa-phone text-info me-1"></i>
                                            S·ªë ƒëi·ªán tho·∫°i
                                        </label>
                                        <input type="tel" class="form-control form-control-lg" id="phone" th:field="*{phone}"
                                               placeholder="0123456789">
                                        <div class="form-text">S·ªë ƒëi·ªán tho·∫°i li√™n h·ªá (t√πy ch·ªçn)</div>
                                    </div>

                                    <!-- Role -->
                                    <div class="mb-4">
                                        <label for="roleId" class="form-label fw-semibold">
                                            <i class="fas fa-user-tag text-info me-1"></i>
                                            Vai tr√≤ trong h·ªá th·ªëng
                                        </label>
                                        <select class="form-select form-select-lg" id="roleId" th:field="*{roleId}">
                                            <option value="1">üëë Administrator (Qu·∫£n tr·ªã vi√™n)</option>
                                            <option value="2">üë§ User (Ng∆∞·ªùi d√πng th∆∞·ªùng)</option>
                                        </select>
                                        <div class="form-text">
                                            Admin c√≥ quy·ªÅn qu·∫£n l√Ω to√†n b·ªô h·ªá th·ªëng, User ch·ªâ c√≥ quy·ªÅn xem
                                        </div>
                                    </div>

                                    <!-- Avatar Upload -->
                                    <div class="mb-4">
                                        <label for="avatarFile" class="form-label fw-semibold">
                                            <i class="fas fa-user-circle text-info me-1"></i>
                                            ·∫¢nh ƒë·∫°i di·ªán
                                        </label>
                                        <input type="file" class="form-control" id="avatarFile" name="avatarFile" 
                                               accept="image/*" onchange="previewImage(this, 'avatarPreview')">
                                        <div class="form-text">Ch·ªçn ·∫£nh ƒë·∫°i di·ªán (JPG, PNG, GIF - t·ªëi ƒëa 10MB)</div>
                                        
                                        <!-- Current Avatar -->
                                        <div th:if="${user.avatar}" class="mt-3">
                                            <label class="form-label">·∫¢nh ƒë·∫°i di·ªán hi·ªán t·∫°i:</label>
                                            <div class="d-flex align-items-center">
                                                <i class="fas fa-file-image text-success me-2"></i>
                                                <span class="text-muted" th:text="${user.avatar}"></span>
                                            </div>
                                        </div>
                                        
                                        <!-- Avatar Preview -->
                                        <div class="mt-2">
                                            <img id="avatarPreview" class="img-thumbnail rounded-circle" 
                                                 style="max-width: 150px; max-height: 150px; display: none;" alt="Avatar Preview">
                                        </div>
                                    </div>

                                    <!-- Active Status -->
                                    <div class="mb-4">
                                        <label for="active" class="form-label fw-semibold">
                                            <i class="fas fa-toggle-on text-info me-1"></i>
                                            Tr·∫°ng th√°i t√†i kho·∫£n
                                        </label>
                                        <select class="form-select form-select-lg" id="active" th:field="*{active}">
                                            <option value="true">üü¢ Ho·∫°t ƒë·ªông - C√≥ th·ªÉ ƒëƒÉng nh·∫≠p</option>
                                            <option value="false">üî¥ T·∫°m kh√≥a - Kh√¥ng th·ªÉ ƒëƒÉng nh·∫≠p</option>
                                        </select>
                                        <div class="form-text">
                                            T√†i kho·∫£n kh√¥ng ho·∫°t ƒë·ªông s·∫Ω kh√¥ng th·ªÉ ƒëƒÉng nh·∫≠p v√†o h·ªá th·ªëng
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Additional Info Section -->
                            <div class="row mt-4" th:if="${user.id != null}">
                                <div class="col-12">
                                    <div class="card bg-light">
                                        <div class="card-body">
                                            <h6 class="card-title">
                                                <i class="fas fa-info-circle text-primary me-2"></i>
                                                Th√¥ng tin b·ªï sung
                                            </h6>
                                            <div class="row">
                                                <div class="col-md-6">
                                                    <small class="text-muted">
                                                        <strong>ID ng∆∞·ªùi d√πng:</strong> <span th:text="${user.id}"></span>
                                                    </small>
                                                </div>
                                                <div class="col-md-6">
                                                    <small class="text-muted">
                                                        <strong>Vai tr√≤:</strong> 
                                                        <span th:text="${user.roleId == 1 ? 'Administrator' : 'User'}"></span>
                                                    </small>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Action Buttons -->
                            <div class="row mt-5">
                                <div class="col-12">
                                    <div class="d-flex justify-content-between align-items-center">
                                        <a href="/users" class="btn btn-outline-secondary btn-lg">
                                            <i class="fas fa-arrow-left me-2"></i>Quay l·∫°i danh s√°ch
                                        </a>
                                        <div>
                                            <button type="reset" class="btn btn-outline-warning btn-lg me-2" 
                                                    th:if="${user.id == null}">
                                                <i class="fas fa-undo me-2"></i>ƒê·∫∑t l·∫°i
                                            </button>
                                            <button type="submit" class="btn btn-info btn-lg px-5">
                                                <i class="fas fa-save me-2"></i>
                                                <span th:text="${user.id != null ? 'C·∫≠p nh·∫≠t th√¥ng tin' : 'Th√™m ng∆∞·ªùi d√πng'}"></span>
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </form>
                    </div>
                </div>
                
                <!-- Help Card -->
                <div class="card border-0 shadow-sm mt-4">
                    <div class="card-header bg-light">
                        <h6 class="mb-0">
                            <i class="fas fa-question-circle text-warning me-2"></i>
                            H∆∞·ªõng d·∫´n
                        </h6>
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <div class="col-md-6">
                                <ul class="list-unstyled mb-0">
                                    <li class="mb-2">
                                        <i class="fas fa-check-circle text-success me-2"></i>
                                        <strong>Username:</strong> Ch·ªâ ch·ª©a ch·ªØ c√°i, s·ªë v√† d·∫•u g·∫°ch d∆∞·ªõi
                                    </li>
                                    <li class="mb-2">
                                        <i class="fas fa-check-circle text-success me-2"></i>
                                        <strong>Email:</strong> Ph·∫£i l√† ƒë·ªãa ch·ªâ email h·ª£p l·ªá
                                    </li>
                                    <li class="mb-0">
                                        <i class="fas fa-check-circle text-success me-2"></i>
                                        <strong>M·∫≠t kh·∫©u:</strong> T·ªëi thi·ªÉu 6 k√Ω t·ª±
                                    </li>
                                </ul>
                            </div>
                            <div class="col-md-6">
                                <ul class="list-unstyled mb-0">
                                    <li class="mb-2">
                                        <i class="fas fa-info-circle text-primary me-2"></i>
                                        <strong>Admin:</strong> C√≥ quy·ªÅn qu·∫£n l√Ω to√†n b·ªô h·ªá th·ªëng
                                    </li>
                                    <li class="mb-2">
                                        <i class="fas fa-info-circle text-primary me-2"></i>
                                        <strong>User:</strong> Ch·ªâ c√≥ quy·ªÅn xem v√† s·ª≠ d·ª•ng
                                    </li>
                                    <li class="mb-0">
                                        <i class="fas fa-info-circle text-primary me-2"></i>
                                        <strong>Tr·∫°ng th√°i:</strong> C√≥ th·ªÉ t·∫°m kh√≥a t√†i kho·∫£n
                                    </li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <footer th:replace="fragments/layout :: footer"></footer>
    <script th:replace="fragments/layout :: scripts"></script>
</body>
</html>